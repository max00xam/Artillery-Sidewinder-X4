[GUIDE] How to control the Toolhead LED on Artillery Sidewinder X4 (Pro/Plus)

The Toolhead LED on the Sidewinder X4 is often "locked" by the internal MCU firmware, making it impossible to control via standard Klipper [output_pin] settings without causing conflicts. This guide uses a Bash script approach to control the GPIO of the MKS PI directly, bypassing firmware limitations.
1. How to Find the Correct GPIO Pin

Before starting, you must identify which GPIO is wired to your LED.

    SSH into your printer (User: mks, Pass: makerbase).

    Open the "Value" monitor: Run this command to watch all active GPIO states:
    Bash

    watch -n 0.5 "cat /sys/class/gpio/gpio*/value"

    Toggle the light: Use the physical touch screen on the printer to turn the LED on and off.

    Identify the change: Look for the number that flips between 0 and 1.

        On most X4 Pro units, it is GPIO 79.

        If yours is different (e.g., 83 or 86), replace 79 in the scripts below.

2. Setting Up Permissions

Klipper needs permission to run system-level commands without a password prompt.

    Run: sudo visudo

    Scroll to the end of the file and add this line:
    Plaintext

    mks ALL=(ALL) NOPASSWD: ALL

    Save and Exit (Ctrl+O, Enter, Ctrl+X).

3. Creating the Logic Script

This script safely handles the GPIO initialization (export) and direction setting.

    Create the file: nano ~/led_control.sh

    Paste this code:
    Bash

    #!/bin/bash
    # Replace 79 with your identified pin if different
    PIN=79

    # Export the pin if not already present
    if [ ! -d /sys/class/gpio/gpio$PIN ]; then
        echo $PIN | sudo tee /sys/class/gpio/export > /dev/null
        sleep 0.1
    fi

    # Set direction to output
    echo out | sudo tee /sys/class/gpio/gpio$PIN/direction > /dev/null

    # Set the value (1 for ON, 0 for OFF)
    echo $1 | sudo tee /sys/class/gpio/gpio$PIN/value > /dev/null

    Make it executable: chmod +x ~/led_control.sh.

4. Klipper Configuration (printer.cfg)

Add these macros to your config to create buttons in Fluidd/Mainsail.
YAML

[gcode_shell_command set_led]
command: /home/mks/led_control.sh
timeout: 2.
verbose: True

[gcode_macro LED_ON]
gcode:
    RUN_SHELL_COMMAND CMD=set_led PARAMS=1

[gcode_macro LED_OFF]
gcode:
    RUN_SHELL_COMMAND CMD=set_led PARAMS=0

    IMPORTANT: Remove any existing [output_pin] sections in your printer.cfg that use the same GPIO pin. Klipper will crash if it tries to claim a pin already managed by the system script.
